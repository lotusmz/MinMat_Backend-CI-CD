<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ProductRestController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">MindMat Backend</a> &gt; <a href="index.source.html" class="el_package">com.project.demo.rest.product</a> &gt; <span class="el_source">ProductRestController.java</span></div><h1>ProductRestController.java</h1><pre class="source lang-java linenums">package com.project.demo.rest.product;

import com.project.demo.logic.entity.category.Category;
import com.project.demo.logic.entity.http.GlobalResponseHandler;
import com.project.demo.logic.entity.http.Meta;
import com.project.demo.logic.entity.product.Product;
import com.project.demo.logic.entity.product.ProductRepository;
import jakarta.servlet.http.HttpServletRequest;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageRequest;
import org.springframework.data.domain.Pageable;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.web.bind.annotation.*;

import java.util.List;
import java.util.Optional;

@RestController
@RequestMapping(&quot;/products&quot;)
// Todas las rutas de este controller har√°n solicitud a /products
<span class="nc" id="L24">public class ProductRestController {</span>

    @Autowired
    private ProductRepository productRepository;

    @GetMapping
    @PreAuthorize(&quot;isAuthenticated()&quot;)
    public ResponseEntity&lt;?&gt; getAll(
            @RequestParam(defaultValue = &quot;1&quot;) int page,
            @RequestParam(defaultValue = &quot;10&quot;) int size,
            HttpServletRequest request) {

<span class="nc" id="L36">        Pageable pageable = PageRequest.of(page-1, size);</span>
<span class="nc" id="L37">        Page&lt;Product&gt; productsPage = productRepository.findAll(pageable);</span>
<span class="nc" id="L38">        Meta meta = new Meta(request.getMethod(), request.getRequestURL().toString());</span>
<span class="nc" id="L39">        meta.setTotalPages(productsPage.getTotalPages());</span>
<span class="nc" id="L40">        meta.setTotalElements(productsPage.getTotalElements());</span>
<span class="nc" id="L41">        meta.setPageNumber(productsPage.getNumber() + 1);</span>
<span class="nc" id="L42">        meta.setPageSize(productsPage.getSize());</span>

<span class="nc" id="L44">        return new GlobalResponseHandler().handleResponse(&quot;Product retrieved successfully&quot;,</span>
<span class="nc" id="L45">                productsPage.getContent(), HttpStatus.OK, meta);</span>
    }

    @PostMapping
    @PreAuthorize(&quot;hasAnyRole('ADMIN', 'SUPER_ADMIN')&quot;)
    public ResponseEntity&lt;?&gt; addProduct(@RequestBody Product product, HttpServletRequest request) {
<span class="nc" id="L51">        productRepository.save(product);</span>
<span class="nc" id="L52">        return new GlobalResponseHandler().handleResponse(&quot;Product created successfully&quot;,</span>
                product, HttpStatus.CREATED, request);
    }

    // Las solicitudes de consulta no necesitan permiso de admin
    @GetMapping(&quot;/{id}&quot;)
    public Product getProductById(@PathVariable Long id) {
<span class="nc" id="L59">        return productRepository.findById(id)</span>
<span class="nc" id="L60">                .orElseThrow(() -&gt; new RuntimeException(&quot;Product not found&quot;));</span>
    }

    @GetMapping(&quot;/filterByName/{name}&quot;)
    public List&lt;Product&gt; getProductsByName(@PathVariable String name) {
<span class="nc" id="L65">        return productRepository.findProductsWithNameContaining(name);</span>
    }

    @PutMapping(&quot;/{id}&quot;)
    @PreAuthorize(&quot;hasAnyRole('ADMIN', 'SUPER_ADMIN')&quot;)
    public Product updateProduct(@PathVariable Long id, @RequestBody Product product) {
<span class="nc" id="L71">        return productRepository.findById(id)</span>
<span class="nc" id="L72">                .map(existingProduct -&gt; {</span>
<span class="nc" id="L73">                    existingProduct.setName(product.getName());</span>
<span class="nc" id="L74">                    existingProduct.setDescription(product.getDescription());</span>
<span class="nc" id="L75">                    existingProduct.setPrice(product.getPrice());</span>
<span class="nc" id="L76">                    existingProduct.setStockQuantity(product.getStockQuantity());</span>
<span class="nc" id="L77">                    existingProduct.setCategory(product.getCategory());</span>
<span class="nc" id="L78">                    return productRepository.save(existingProduct);</span>
                })
<span class="nc" id="L80">                .orElseGet(() -&gt; {</span>
<span class="nc" id="L81">                    product.setId(id);</span>
<span class="nc" id="L82">                    return productRepository.save(product);</span>
                });
    }
    public ResponseEntity&lt;?&gt; updateProduct(@PathVariable Long id, @RequestBody Product product, HttpServletRequest request) {
<span class="nc" id="L86">        Optional&lt;Product&gt; foundProduct = productRepository.findById(id);</span>
<span class="nc bnc" id="L87" title="All 2 branches missed.">        if(foundProduct.isPresent()) {</span>
<span class="nc" id="L88">            product.setId(foundProduct.get().getId());</span>
<span class="nc" id="L89">            product.setName(foundProduct.get().getName());</span>
<span class="nc" id="L90">            product.setDescription(foundProduct.get().getDescription());</span>
<span class="nc" id="L91">            product.setPrice(foundProduct.get().getPrice());</span>
<span class="nc" id="L92">            product.setStockQuantity(foundProduct.get().getStockQuantity());</span>
<span class="nc" id="L93">            product.setCategory(foundProduct.get().getCategory());</span>
<span class="nc" id="L94">            productRepository.save(product);</span>
<span class="nc" id="L95">            return new GlobalResponseHandler().handleResponse(&quot;Product updated successfully&quot;,</span>
                    product, HttpStatus.OK, request);
        } else {
<span class="nc" id="L98">            return new GlobalResponseHandler().handleResponse(&quot;Product id &quot; + id + &quot; not found&quot;  ,</span>
                    HttpStatus.NOT_FOUND, request);
        }
    }

    @DeleteMapping(&quot;/{id}&quot;)
    @PreAuthorize(&quot;hasAnyRole('ADMIN', 'SUPER_ADMIN')&quot;)
    public ResponseEntity&lt;?&gt; deleteProduct(@PathVariable Long id, HttpServletRequest request) {
<span class="nc" id="L106">        Optional&lt;Product&gt; foundProduct = productRepository.findById(id);</span>
<span class="nc bnc" id="L107" title="All 2 branches missed.">        if(foundProduct.isPresent()) {</span>
<span class="nc" id="L108">            productRepository.deleteById(foundProduct.get().getId());</span>
<span class="nc" id="L109">            return new GlobalResponseHandler().handleResponse(&quot;Product deleted successfully&quot;,</span>
<span class="nc" id="L110">                    foundProduct.get(), HttpStatus.OK, request);</span>
        } else {
<span class="nc" id="L112">            return new GlobalResponseHandler().handleResponse(&quot;Product id &quot; + id + &quot; not found&quot;  ,</span>
                    HttpStatus.NOT_FOUND, request);
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>